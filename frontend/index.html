<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plan Your Workout</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-neutral-100 text-neutral-900 antialiased font-[Inter]">
  <!-- Nav -->
  <header class="border-b border-neutral-200 bg-white/80 backdrop-blur">
    <div class="mx-auto max-w-7xl px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-tr from-indigo-600 via-violet-600 to-fuchsia-600 text-white">
          <i data-lucide="compass" class="h-5 w-5"></i>
        </span>
        <span class="text-lg font-semibold tracking-tight">Workout Planner</span>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="mx-auto max-w-7xl px-6 pt-10 pb-8">
    <div class="relative overflow-hidden rounded-2xl border border-neutral-800 bg-gradient-to-tr from-neutral-950 via-neutral-900 to-neutral-800">
      <!-- Abstract banner icon graphics (dumbbells + barbells) -->
      <div class="pointer-events-none absolute inset-0 opacity-25">
        <div class="absolute -left-10 -top-10 h-72 w-72 rounded-full bg-white/10 blur-3xl"></div>
        <div class="absolute -right-10 -bottom-10 h-72 w-72 rounded-full bg-white/10 blur-3xl"></div>
        <div class="absolute inset-0 grid grid-cols-6 gap-6 p-10 text-white/35">
          <i data-lucide="dumbbell" class="h-10 w-10 rotate-12"></i>
          <svg class="h-10 w-10 -rotate-6" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M10 24v16M54 24v16" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M16 20v24M48 20v24" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M20 32h24" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M6 28v8M58 28v8" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </svg>
          <i data-lucide="dumbbell" class="h-10 w-10 -rotate-12"></i>
          <svg class="h-10 w-10 rotate-6" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M10 24v16M54 24v16" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M16 20v24M48 20v24" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M20 32h24" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M6 28v8M58 28v8" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </svg>
          <i data-lucide="dumbbell" class="h-10 w-10 rotate-6"></i>
          <i data-lucide="dumbbell" class="h-10 w-10 -rotate-6"></i>
          <svg class="h-10 w-10 rotate-12" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M10 24v16M54 24v16" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M16 20v24M48 20v24" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M20 32h24" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M6 28v8M58 28v8" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </svg>
          <i data-lucide="dumbbell" class="h-10 w-10 -rotate-12"></i>
          <svg class="h-10 w-10 -rotate-12" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M10 24v16M54 24v16" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M16 20v24M48 20v24" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M20 32h24" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M6 28v8M58 28v8" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </svg>
          <i data-lucide="dumbbell" class="h-10 w-10 rotate-12"></i>
          <i data-lucide="dumbbell" class="h-10 w-10 -rotate-6"></i>
          <svg class="h-10 w-10 rotate-6" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M10 24v16M54 24v16" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M16 20v24M48 20v24" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M20 32h24" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M6 28v8M58 28v8" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </svg>
          <i data-lucide="dumbbell" class="h-10 w-10 -rotate-12"></i>
          <svg class="h-10 w-10 -rotate-6" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M10 24v16M54 24v16" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M16 20v24M48 20v24" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
            <path d="M20 32h24" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            <path d="M6 28v8M58 28v8" stroke="currentColor" stroke-width="6" stroke-linecap="round"/>
          </svg>
          <i data-lucide="dumbbell" class="h-10 w-10 rotate-6"></i>
        </div>
      </div>
      <div class="relative grid gap-6 p-8 md:grid-cols-3 md:p-12">
        <div class="md:col-span-2">
          <h1 class="text-white text-4xl md:text-5xl font-semibold tracking-tight leading-tight">
            Plan Your Workout
          </h1>
          <p class="mt-3 text-neutral-200/90 text-base md:text-lg">
            Set your goal, choose your equipment, and get a personalized day-by-day workout plan in seconds.
          </p>
          <div class="mt-6 flex flex-wrap items-center gap-3">
            <div class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-2 text-white text-sm">
              <i data-lucide="target" class="h-4 w-4"></i>
              Goal-focused
            </div>
            <div class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-2 text-white text-sm">
              <i data-lucide="calendar" class="h-4 w-4"></i>
              Day-by-day plans
            </div>
            <div class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-2 text-white text-sm">
              <i data-lucide="dumbbell" class="h-4 w-4"></i>
              Equipment-aware
            </div>
          </div>
        </div>
        <div class="hidden md:block">
          <!-- Image-only panel -->
          <div class="relative h-full w-full overflow-hidden rounded-xl bg-white/5 ring-1 ring-white/15">
            <img
              alt="Bodybuilder doing a bicep curl"
              src="/assets/banner_bodybuilder_curl.png"
              class="h-full w-full object-cover grayscale contrast-125 brightness-110"
            />
            <!-- Neutral grey tint overlay (no other content) -->
            <div class="pointer-events-none absolute inset-0 bg-neutral-900/45"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Feature cards -->
    <div class="mt-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
      <div class="rounded-xl border border-neutral-200 bg-white p-5 shadow-sm">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-neutral-100 text-neutral-700">
            <i data-lucide="user" class="h-5 w-5"></i>
          </span>
          <div>
            <div class="font-semibold tracking-tight">Fitness Profile</div>
            <p class="text-sm text-neutral-600">Level, constraints, recovery.</p>
          </div>
        </div>
      </div>
      <div class="rounded-xl border border-neutral-200 bg-white p-5 shadow-sm">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-neutral-100 text-neutral-700">
            <i data-lucide="calendar-clock" class="h-5 w-5"></i>
          </span>
          <div>
            <div class="font-semibold tracking-tight">Plans</div>
            <p class="text-sm text-neutral-600">Day-by-day workout schedules.</p>
          </div>
        </div>
      </div>
      <div class="rounded-xl border border-neutral-200 bg-white p-5 shadow-sm">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-neutral-100 text-neutral-700">
            <i data-lucide="dumbbell" class="h-5 w-5"></i>
          </span>
          <div>
            <div class="font-semibold tracking-tight">Equipment</div>
            <p class="text-sm text-neutral-600">Session length & options.</p>
          </div>
        </div>
      </div>
      <div class="rounded-xl border border-neutral-200 bg-white p-5 shadow-sm">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-neutral-100 text-neutral-700">
            <i data-lucide="list" class="h-5 w-5"></i>
          </span>
          <div>
            <div class="font-semibold tracking-tight">Exercise Library</div>
            <p class="text-sm text-neutral-600">Movements & progressions.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Planner -->
  <main class="mx-auto max-w-7xl px-6 pb-20">
    <div class="grid gap-6 lg:grid-cols-3">
      <!-- Form -->
      <section class="rounded-xl border border-neutral-200 bg-white p-6 shadow-sm">
        <h2 class="text-2xl font-semibold tracking-tight">Plan Your Workout</h2>
        <p class="mt-1 text-sm text-neutral-600">Enter your goal, duration, fitness level, equipment, and constraints.</p>

        <form id="plannerForm" class="mt-6 space-y-4" autocomplete="off">
          <!-- Goal -->
          <div>
            <label for="goal" class="block text-sm font-medium text-neutral-800">Goal</label>
            <div class="mt-2 relative">
              <input id="goal" type="text" required placeholder="e.g., build strength, run 5K, lose weight"
                     class="w-full rounded-lg border border-neutral-300 bg-white px-3.5 py-2.5 text-neutral-900 placeholder-neutral-400 shadow-sm outline-none ring-0 focus:border-neutral-400 focus:ring-2 focus:ring-neutral-200" />
              <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400">
                <i data-lucide="target" class="h-4.5 w-4.5"></i>
              </span>
            </div>
          </div>

          <!-- Duration -->
          <div>
            <label for="duration" class="block text-sm font-medium text-neutral-800">Duration</label>
            <div class="mt-2 relative">
              <input id="duration" type="text" required placeholder="e.g., 4 weeks, 8 weeks"
                     class="w-full rounded-lg border border-neutral-300 bg-white px-3.5 py-2.5 text-neutral-900 placeholder-neutral-400 shadow-sm outline-none ring-0 focus:border-neutral-400 focus:ring-2 focus:ring-neutral-200" />
              <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400">
                <i data-lucide="calendar" class="h-4.5 w-4.5"></i>
              </span>
            </div>
          </div>

          <!-- Fitness level -->
          <div>
            <label for="fitnessLevel" class="block text-sm font-medium text-neutral-800">Fitness level</label>
            <div class="mt-2 relative">
              <select id="fitnessLevel"
                      class="w-full rounded-lg border border-neutral-300 bg-white px-3.5 py-2.5 text-neutral-900 shadow-sm outline-none ring-0 focus:border-neutral-400 focus:ring-2 focus:ring-neutral-200">
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
            </div>
          </div>

          <!-- Equipment -->
          <div>
            <label for="equipment" class="block text-sm font-medium text-neutral-800">Equipment</label>
            <div class="mt-2 relative">
              <select id="equipment"
                      class="w-full rounded-lg border border-neutral-300 bg-white px-3.5 py-2.5 text-neutral-900 shadow-sm outline-none ring-0 focus:border-neutral-400 focus:ring-2 focus:ring-neutral-200">
                <option value="none">None (bodyweight)</option>
                <option value="dumbbells">Dumbbells</option>
                <option value="resistance bands">Resistance bands</option>
                <option value="full gym">Full gym</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <!-- Days per week -->
          <div>
            <label for="daysPerWeek" class="block text-sm font-medium text-neutral-800">Days per week</label>
            <div class="mt-2 relative">
              <input id="daysPerWeek" type="number" inputmode="numeric" min="1" max="7" step="1" value="3" placeholder="e.g., 3"
                     class="w-full rounded-lg border border-neutral-300 bg-white px-3.5 py-2.5 text-neutral-900 placeholder-neutral-400 shadow-sm outline-none ring-0 focus:border-neutral-400 focus:ring-2 focus:ring-neutral-200" />
            </div>
          </div>

          <!-- Constraints -->
          <div>
            <label for="constraints" class="block text-sm font-medium text-neutral-800">Constraints (optional)</label>
            <div class="mt-2 relative">
              <input id="constraints" type="text" placeholder="e.g., no running, knee-friendly"
                     class="w-full rounded-lg border border-neutral-300 bg-white px-3.5 py-2.5 text-neutral-900 placeholder-neutral-400 shadow-sm outline-none ring-0 focus:border-neutral-400 focus:ring-2 focus:ring-neutral-200" />
            </div>
          </div>

          <!-- Submit -->
          <div class="pt-2">
            <button type="submit"
                    class="w-full inline-flex items-center justify-center gap-2 rounded-lg bg-neutral-900 px-4 py-3 text-white shadow-sm transition hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">
              <i data-lucide="dumbbell" class="h-5 w-5"></i>
              <span class="font-medium">Plan My Workout</span>
            </button>
          </div>
        </form>
      </section>

      <!-- Output -->
      <section class="lg:col-span-2 space-y-6">
        <div id="placeholderCard" class="rounded-xl border border-neutral-200 bg-white p-8 text-center shadow-sm">
          <h3 class="text-xl md:text-2xl font-semibold tracking-tight">Fill out the form to get your personalized workout plan</h3>
          <p class="mt-2 text-neutral-600">Enter your details on the leftâ€”your day-by-day plan will appear here.</p>
          <div class="mt-6 grid gap-3 sm:grid-cols-3">
            <div class="rounded-lg border border-neutral-200 p-4">
              <div class="flex items-center gap-2 text-neutral-700">
                <i data-lucide="dumbbell" class="h-4 w-4"></i>
                Strength
              </div>
              <p class="mt-1 text-sm text-neutral-600">Progressive resistance, form cues.</p>
            </div>
            <div class="rounded-lg border border-neutral-200 p-4">
              <div class="flex items-center gap-2 text-neutral-700">
                <i data-lucide="activity" class="h-4 w-4"></i>
                Cardio
              </div>
              <p class="mt-1 text-sm text-neutral-600">Conditioning and heart rate.</p>
            </div>
            <div class="rounded-lg border border-neutral-200 p-4">
              <div class="flex items-center gap-2 text-neutral-700">
                <i data-lucide="heart" class="h-4 w-4"></i>
                Recovery
              </div>
              <p class="mt-1 text-sm text-neutral-600">Rest days and mobility.</p>
            </div>
          </div>
        </div>

        <div id="results" class="hidden space-y-6"></div>
      </section>
    </div>
  </main>

  <footer class="border-t border-neutral-200 bg-white">
    <div class="mx-auto max-w-7xl px-6 py-10 text-sm text-neutral-600">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2">
          <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-neutral-900 text-white">
            <i data-lucide="compass" class="h-4.5 w-4.5"></i>
          </span>
          <span>&copy; <span id="year"></span> Workout Planner</span>
        </div>
        <div class="flex items-center gap-4">
          <a class="hover:text-neutral-900" href="#">Privacy</a>
          <a class="hover:text-neutral-900" href="#">Terms</a>
          <a class="hover:text-neutral-900" href="#">Support</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    // Initialize icons and year
    function renderIcons() { if (window.lucide) lucide.createIcons(); }
    document.getElementById('year').textContent = new Date().getFullYear();
    renderIcons();

    // Planner logic (calls backend)
    const form = document.getElementById('plannerForm');
    const results = document.getElementById('results');
    const placeholderCard = document.getElementById('placeholderCard');

    async function submitToBackend(e) {
      e.preventDefault();

      const goal = (document.getElementById('goal').value || '').trim();
      const duration = (document.getElementById('duration').value || '').trim();
      const fitnessLevel = (document.getElementById('fitnessLevel').value || 'beginner').trim();
      const equipment = (document.getElementById('equipment').value || 'none').trim();
      const daysPerWeek = Math.max(1, Math.min(7, parseInt(document.getElementById('daysPerWeek').value || '3', 10)));
      const constraints = (document.getElementById('constraints').value || '').trim();

      if (!goal || !duration) {
        alert('Please enter a goal and duration.');
        return;
      }

      placeholderCard.classList.add('hidden');
      results.classList.remove('hidden');
      results.innerHTML = `
        <div class="rounded-xl border border-neutral-200 bg-white p-6 shadow-sm">
          <div class="flex items-center gap-3 text-neutral-700">
            <i data-lucide="loader-2" class="h-5 w-5 animate-spin"></i>
            Planning your workout...
          </div>
        </div>
      `;
      renderIcons();

      try {
        const resp = await fetch('/plan-workout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ goal, duration, fitness_level: fitnessLevel, equipment, days_per_week: daysPerWeek, constraints })
        });

        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        const md = (data && data.result) ? data.result : 'No result';

        const content = (window.marked && window.marked.parse) ? window.marked.parse(md) : `<pre class="whitespace-pre-wrap">${md}</pre>`;
        results.innerHTML = `
          <div class="rounded-xl border border-neutral-200 bg-white p-6 shadow-sm">
            <div class="mb-3 flex items-center justify-between">
              <h3 class="text-xl font-semibold tracking-tight">Your Workout Plan</h3>
              <button id="printBtn" class="inline-flex items-center gap-2 rounded-lg border border-neutral-300 bg-white px-3 py-1.5 text-sm hover:bg-neutral-50">
                <i data-lucide="printer" class="h-4 w-4"></i> Print / PDF
              </button>
            </div>
            <div class="prose max-w-none">${content}</div>
          </div>
        `;
        renderIcons();
        const printBtn = document.getElementById('printBtn');
        printBtn?.addEventListener('click', () => window.print());
      } catch (err) {
        results.innerHTML = `
          <div class="rounded-xl border border-red-200 bg-red-50 p-6 text-red-700">
            <div class="flex items-center gap-2">
              <i data-lucide="alert-triangle" class="h-5 w-5"></i>
              <span>Failed to plan workout. Please try again.</span>
            </div>
          </div>
        `;
        renderIcons();
        console.error('Plan error:', err);
      }
    }

    form.addEventListener('submit', submitToBackend);
  </script>
</body>
</html>
